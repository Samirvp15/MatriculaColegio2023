<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Facelet Title</title>
        <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css" rel="stylesheet"/>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
        <link rel="stylesheet" href="../ComponentesWeb/Custom_CSS.css"/>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    </h:head>
    <h:body>
        <div class="container-fluid">
            <div class="row">
                <b:form>
                    <nav class="sidebar">
                        <div class="position-sticky">
                            <ul class="nav flex-column">
                                <div class="row-imagen">
                                    <div class="col-md-2">
                                        <img src="../img/logocole.png" alt="Logo de la Empresa"/>
                                    </div>
                                </div>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Estudiantes">
                                        <div class="icon">
                                            <img src="../img/icon-estudiantes.png" alt="Estudiantes"/>
                                        </div>
                                        <span>Estudiantes</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Apoderados">
                                        <div class="icon">
                                            <img src="../img/icon-docentes.png" alt="Apoderados"/>
                                        </div>
                                        <span>Apoderados</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Docentes">
                                        <div class="icon">
                                            <img src="../img/icon-docentes.png" alt="Docentes"/>
                                        </div>
                                        <span>Docentes</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Salones">
                                        <div class="icon">
                                            <img src="../img/icon-salones.png" alt="Salones"/>
                                        </div>
                                        <span>Salones</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Clases">
                                        <div class="icon">
                                            <img src="../img/icon-grados.png" alt="Clases"/>
                                        </div>
                                        <span>Clases</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Horarios">
                                        <div class="icon">
                                            <img src="../img/icon-horarios.png" alt="Horarios"/>
                                        </div>
                                        <span>Horarios</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Cursos">
                                        <div class="icon">
                                            <img src="../img/cuaderno.png" alt="Cursos"/>
                                        </div>
                                        <span>Cursos</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Matricula">
                                        <div class="icon">
                                            <img src="../img/tesis.png" alt="Matricula"/>
                                        </div>
                                        <span>Matricula</span>
                                    </b:commandButton>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </b:form>
                <!-- REGISTRO SALONES -->
                <div class="header"> 
                    <h1>Registro de Salones</h1>
                </div>

                <main class="col-md-10">
                    <!-- Texto Modal -->
                    <button type="button" class="btn btn-primary mb-4" data-toggle="modal" data-target="#myModal3">
                        Registrar Salon
                    </button>

                    <div class="modal" id="myModal3" >
                        <div class="modal-dialog  modal-lg">
                            <div class="modal-content">
                                <!-- Header -->
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Ingrese datos a registrar</h1>
                                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">X</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <!--Modal aquí -->
                                    <div class="container-fluid">
                                        <div class="row">
                                            <!--Contenido Principal aquí -->
                                            <b:form id="RegisterForm">
                                                <h2 class="Separador">Datos del Salon</h2>
                                                <div class="row">
                                                    <div class="col-4 mt-2">
                                                        <h4>ID Salon</h4>
                                                        <b:inputText id="idSalon" value="#{beanSalon.idSalon}" required="true" requiredMessage="El ID es obligatorio"/> 
                                                        <b:message for="@previous" />
                                                    </div>
                                                    <div class="col-4 mt-2">
                                                        <h4>Grado</h4>
                                                        <b:selectOneMenu id="grado" value="#{beanSalon.grado}">
                                                            <f:selectItem itemValue="1er grado" itemLabel="1er grado"/>
                                                            <f:selectItem itemValue="2do grado" itemLabel="2do grado"/>
                                                            <f:selectItem itemValue="3er grado" itemLabel="3er grado"/>
                                                            <f:selectItem itemValue="4to grado" itemLabel="4to grado"/>
                                                            <f:selectItem itemValue="5to grado" itemLabel="5to grado"/>
                                                            <f:selectItem itemValue="6to grado" itemLabel="6to grado"/>
                                                        </b:selectOneMenu>
                                                    </div>
                                                </div>
                                                <br/>
                                                <br/>
                                                <b:commandButton class="btn btn-lg btn-success" value="Registrar Salon" action="#{beanSalon.agregarSalon()}">
                                                    <f:ajax execute="@form" render="@form"></f:ajax>
                                                </b:commandButton>
                                                <h:outputScript rendered="#{beanSalon.registrationSuccessful}">
                                                    mostrarAlerta();
                                                    #{beanSalon.resetRegistrationStatus()};                                                   
                                                </h:outputScript>
                                            </b:form>
                                        </div>
                                    </div>
                                </div>
                                <!-- Footer -->
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary col-3" data-dismiss="modal">Cerrar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- LISTAR SALONES -->
                    <h1>Ver Salones</h1>
                    <div class="container-fluid">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold text-primary">Datos Registrados</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <b:form>
                                        <b:dataTable value="#{beanSalon.listarSalones()}" var="salon" style="width: 100%;">
                                            <b:dataTableColumn  value="#{salon.idSalon}" label="ID" width="500px"/>
                                            <b:dataTableColumn  value="#{salon.grado}" label="GRADO" width="550px"/>
                                            <b:dataTableColumn label="ACCIONES" width="200px">
                                                <b:commandButton oncomplete="$('.modalPseudoClass2').modal()" value="Editar" look="success" style="width:80px; align-content: center;" action="#{beanSalon.obtenerSalon(salon.idSalon)}">
                                                    <f:ajax execute="@this" render="myFormID">
                                                    </f:ajax>
                                                </b:commandButton>
                                                <b:commandButton value="Eliminar" look="danger" style="width:80px; align-content: center;"
                                                                 action="#{beanSalon.eliminarSalon(salon)}"  />
                                            </b:dataTableColumn>
                                        </b:dataTable>   
                                    </b:form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- EDITAR SALON MODAL-->
                    <b:form id="myFormID">
                        <b:modal  id="amodal2" title="Editar Datos del Salon" styleClass="modalPseudoClass2" closable="false" close-on-escape="false" backdrop="false">
                            <b:panel id="resultado">
                                <div class="row">
                                    <div class="col-6 mt-2">
                                        <h4>ID Salon</h4>
                                        <b:inputText id="nombre" value="#{beanSalon.sal.idSalon}" required="true" requiredMessage="El ID es obligatorio"/> 
                                        <b:message for="@previous" />
                                    </div>
                                    <div class="col-6 mt-2">
                                        <h4>Grado</h4>
                                        <b:selectOneMenu id="grado" value="#{beanSalon.sal.grado}" required="true" requiredMessage="El grado es obligatorio">
                                            <f:selectItem itemValue="1er grado" itemLabel="1er grado"/>
                                            <f:selectItem itemValue="2do grado" itemLabel="2do grado"/>
                                            <f:selectItem itemValue="3er grado" itemLabel="3er grado"/>
                                            <f:selectItem itemValue="4to grado" itemLabel="4to grado"/>
                                            <f:selectItem itemValue="5to grado" itemLabel="5to grado"/>
                                            <f:selectItem itemValue="6to grado" itemLabel="6to grado"/>
                                        </b:selectOneMenu>
                                    </div>
                                    <br/>
                                    <br/>
                                    <div class="col-8 mt-2">
                                        <b:commandButton class="btn btn-lg btn-success" value="Editar Salon" action="#{beanSalon.actualizarSalon(beanSalon.sal)}">
                                            <f:ajax execute="@form" render="@form"></f:ajax>
                                        </b:commandButton>

                                        <h:outputScript rendered="#{beanSalon.registrationSuccessful}">
                                            mostrarAlerta();
                                            #{beanSalon.resetRegistrationStatus()};
                                        </h:outputScript>
                                    </div>
                                </div>
                            </b:panel>
                            <f:facet name="footer">
                                <b:button value="Cerrar" look="secondary" dismiss="modal" />
                                <b:button value="Guardar" look="primary" />
                            </f:facet>
                        </b:modal>
                    </b:form>
                </main>
            </div>
        </div>



        <script type="text/javascript">
            function mostrarAlerta() {

                // La función mostrarAlerta se ejecutará solo si el proceso fue exitoso
                swal({
                    title: "Registrado!",
                    text: "Datos completados correctamente!",
                    icon: "success",
                    button: "OK"
                })
                        .then((value) => {
                            // Si el usuario hace clic en OK, recargar la página
                            if (value) {
                                location.reload();
                            }
                        });
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    </h:body>
</html>