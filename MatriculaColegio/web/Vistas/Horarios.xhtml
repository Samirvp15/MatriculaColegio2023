<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Facelet Title</title>
        <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css" rel="stylesheet"/>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
        <link rel="stylesheet" href="../ComponentesWeb/Custom_CSS.css"/>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    </h:head>
    <h:body>
        <div class="container-fluid">
            <div class="row">
                <b:form>
                    <nav class="sidebar">
                        <div class="position-sticky">
                            <ul class="nav flex-column">
                                <div class="row-imagen">
                                    <div class="col-md-2">
                                        <img src="../img/logocole.png" alt="Logo de la Empresa"/>
                                    </div>
                                </div>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Estudiantes">
                                        <div class="icon">
                                            <img src="../img/icon-estudiantes.png" alt="Estudiantes"/>
                                        </div>
                                        <span>Estudiantes</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Apoderados">
                                        <div class="icon">
                                            <img src="../img/icon-docentes.png" alt="Apoderados"/>
                                        </div>
                                        <span>Apoderados</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Docentes">
                                        <div class="icon">
                                            <img src="../img/icon-docentes.png" alt="Docentes"/>
                                        </div>
                                        <span>Docentes</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Salones">
                                        <div class="icon">
                                            <img src="../img/icon-salones.png" alt="Salones"/>
                                        </div>
                                        <span>Salones</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Clases">
                                        <div class="icon">
                                            <img src="../img/icon-grados.png" alt="Clases"/>
                                        </div>
                                        <span>Clases</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Horarios">
                                        <div class="icon">
                                            <img src="../img/icon-horarios.png" alt="Horarios"/>
                                        </div>
                                        <span>Horarios</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Cursos">
                                        <div class="icon">
                                            <img src="../img/cuaderno.png" alt="Horarios"/>
                                        </div>
                                        <span>Cursos</span>
                                    </b:commandButton>
                                </li>
                                <li class="nav-item">
                                    <b:commandButton class="nav-link" action="Matricula">
                                        <div class="icon">
                                            <img src="../img/tesis.png" alt="Matricula"/>
                                        </div>
                                        <span>Matricula</span>
                                    </b:commandButton>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </b:form>
                <!-- REGISTRO HORARIOS -->
                <div class="header"> 
                    <h1>Registro de Horarios</h1>
                </div>

                <main class="col-md-10">
                    <!-- Texto Modal -->
                    <button type="button" class="btn btn-primary mb-4" data-toggle="modal" data-target="#myModal3">
                        Registrar Horario
                    </button>

                    <div class="modal" id="myModal3" >
                        <div class="modal-dialog  modal-lg">
                            <div class="modal-content">
                                <!-- Header -->
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Ingrese datos a registrar</h1>
                                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">X</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <!--Modal aquí -->
                                    <div class="container-fluid">
                                        <div class="row">
                                            <!--Contenido Principal aquí -->
                                            <b:form id="RegisterForm">
                                                <h2 class="Separador">Datos del Horario</h2>
                                                <div class="row">
                                                    <div class="col-4 mt-2">
                                                        <h4>Dia de la Semana</h4>
                                                        <b:selectOneMenu value="#{beanHorario.diaSemana}" id="dia" required="true" requiredMessage="El nombre de salon es obligatorio">
                                                            <f:selectItem itemLabel="Selecciona un día" />
                                                            <f:selectItem itemValue="Lunes" itemLabel="Lunes" />
                                                            <f:selectItem itemValue="Martes" itemLabel="Martes" />
                                                            <f:selectItem itemValue="Miércoles" itemLabel="Miércoles" />
                                                            <f:selectItem itemValue="Jueves" itemLabel="Jueves" />
                                                            <f:selectItem itemValue="Viernes" itemLabel="Viernes" />
                                                            <f:selectItem itemValue="Sábado" itemLabel="Sábado" />
                                                            <f:selectItem itemValue="Domingo" itemLabel="Domingo" />
                                                        </b:selectOneMenu>
                                                        <b:message for="@previous" />
                                                    </div>
                                                    <div class="col-4 mt-2">
                                                        <h4>Grado/Curso</h4>
                                                        <b:selectOneMenu id="idArea" value="#{beanHorario.idclase}">
                                                            <f:selectItems value="#{beanClase.listarClases()}" var="clase" itemLabel="#{clase.idsalon.grado} - #{clase.idcurso.nombreCurso}" itemValue="#{clase}" />
                                                        </b:selectOneMenu>
                                                        <b:message for="@previous" />
                                                    </div>
                                                    <div class="col-4 mt-2">
                                                        <h4>Hora Inicio</h4>
                                                        <b:inputText mask="99:99:99" placeholder="HH:MM:SS" id="horaInicio" value="#{beanHorario.horaInicio}" required="true" requiredMessage="La hora inicial es obligatorio"/>      
                                                        <b:message  for="@previous" />
                                                    </div>
                                                    <div class="col-4 mt-2">
                                                        <h4>Hora Final</h4>
                                                        <b:inputText mask="99:99:99" placeholder="HH:MM:SS" id="horaFinal" value="#{beanHorario.horaFinal}" required="true" requiredMessage="La hora final es obligatoria"/>   
                                                        <b:message for="@previous" />
                                                    </div>
                                                </div>
                                                <br/>
                                                <br/>
                                                <b:commandButton class="btn btn-lg btn-success" value="Registrar Horario" action="#{beanHorario.agregarHorario()}">
                                                    <f:ajax execute="@form" render="@form"></f:ajax>
                                                </b:commandButton>
                                                <h:outputScript rendered="#{beanHorario.registrationSuccessful}">
                                                    mostrarAlerta();
                                                    #{beanHorario.resetRegistrationStatus()};                                                   
                                                </h:outputScript>
                                            </b:form>
                                        </div>
                                    </div>
                                </div>
                                <!-- Footer -->
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary col-3" data-dismiss="modal">Cerrar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- LISTAR HORARIOS -->
                    <h1>Ver Horarios</h1>
                    <div class="container-fluid">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold text-primary">Datos Registrados</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <b:form>
                                        <b:dataTable value="#{beanHorario.listarHorarios()}" var="horario" style="width: 100%;">
                                            <b:dataTableColumn  value="#{horario.idclase.idsalon.grado}" label="Grado" width="220px"/>
                                            <b:dataTableColumn  value="#{horario.diaSemana}" label="Dia de Semana" width="220px"/>
                                            <b:dataTableColumn  value="#{horario.idclase.idcurso.nombreCurso}" label="Curso" width="220px"/>
                                            <b:dataTableColumn  label="Hora de Inicio" width="180px">
                                                <h:outputText value="#{horario.horaInicio}">
                                                    <f:convertDateTime pattern="HH:mm:ss" timeZone="GMT-5" />
                                                </h:outputText>
                                            </b:dataTableColumn>
                                            <b:dataTableColumn  label="Hora de Fin" width="180px">
                                                <h:outputText value="#{horario.horaFinal}">
                                                    <f:convertDateTime pattern="HH:mm:ss" timeZone="GMT-5" />
                                                </h:outputText>
                                            </b:dataTableColumn>
                                             <b:dataTableColumn  value="#{horario.ind}" label="Estado" width="50px"/>
                                            <b:dataTableColumn label="ACCIONES" width="180px">
                                                <b:commandButton oncomplete="$('.modalPseudoClass2').modal()" value="Editar" look="success" style="width:80px; align-content: center;" action="#{beanHorario.obtenerHorario(horario.idHorario)}">
                                                    <f:ajax execute="@this" render="myFormID">
                                                    </f:ajax>
                                                </b:commandButton>
                                                <b:commandButton value="Eliminar" look="danger" style="width:80px; align-content: center;"
                                                                 action="#{beanHorario.eliminarHorario(horario)}"  />
                                            </b:dataTableColumn>
                                        </b:dataTable>   
                                    </b:form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- EDITAR HORARIO MODAL-->
                    <b:form id="myFormID">
                        <b:modal  id="amodal2" title="Editar Datos del Horario" styleClass="modalPseudoClass2" closable="false" close-on-escape="false" backdrop="false">
                            <b:panel id="resultado">
                                <div class="row">
                                    <div class="col-4 mt-2">
                                        <h4>Dia de la Semana</h4>
                                        <b:selectOneMenu value="#{beanHorario.diaSemana}" id="dia" required="true" requiredMessage="El nombre de salon es obligatorio">
                                            <f:selectItem itemLabel="Selecciona un día" />
                                            <f:selectItem itemValue="Lunes" itemLabel="Lunes" />
                                            <f:selectItem itemValue="Martes" itemLabel="Martes" />
                                            <f:selectItem itemValue="Miércoles" itemLabel="Miércoles" />
                                            <f:selectItem itemValue="Jueves" itemLabel="Jueves" />
                                            <f:selectItem itemValue="Viernes" itemLabel="Viernes" />
                                            <f:selectItem itemValue="Sábado" itemLabel="Sábado" />
                                            <f:selectItem itemValue="Domingo" itemLabel="Domingo" />
                                        </b:selectOneMenu>
                                        <b:message for="@previous" />
                                    </div>
                                    <div class="col-4 mt-2">
                                        <h4>Grado/Curso</h4>
                                        <b:selectOneMenu id="idArea" value="#{beanHorario.horarioObj.idclase}">
                                            <f:selectItems value="#{beanClase.listarClases()}" var="clase" itemLabel="#{clase.idsalon.grado} - #{clase.idcurso.nombreCurso}" itemValue="#{clase}" />
                                        </b:selectOneMenu>
                                        <b:message for="@previous" />
                                    </div>
                                    <div class="col-4 mt-2">
                                        <h4>Hora Inicio</h4>
                                        <b:inputText mask="99:99:99" placeholder="HH:MM:SS" id="horaInicio" value="#{beanHorario.horarioObj.horaInicio}" required="true" requiredMessage="La hora inicial es obligatorio"/>      
                                        <b:message  for="@previous" />
                                    </div>
                                    <div class="col-4 mt-2">
                                        <h4>Hora Final</h4>
                                        <b:inputText mask="99:99:99" placeholder="HH:MM:SS" id="horaFinal" value="#{beanHorario.horarioObj.horaFinal}" required="true" requiredMessage="La hora final es obligatoria"/>   
                                        <b:message for="@previous" />
                                    </div>
                                    <br/>
                                    <br/>
                                    <div class="col-8 mt-2">
                                        <b:commandButton class="btn btn-lg btn-success" value="Editar Horario" action="#{beanHorario.actualizarHorario(beanHorario.horarioObj)}">
                                            <f:ajax execute="@form" render="@form"></f:ajax>
                                        </b:commandButton>

                                        <h:outputScript rendered="#{beanHorario.registrationSuccessful}">
                                            mostrarAlerta();
                                            #{beanHorario.resetRegistrationStatus()};                                                   
                                        </h:outputScript>
                                    </div>
                                </div>
                            </b:panel>
                            <f:facet name="footer">
                                <b:button value="Cerrar" look="secondary" dismiss="modal" />
                                <b:button value="Guardar" look="primary" />
                            </f:facet>
                        </b:modal>
                    </b:form>
                </main>
            </div>
        </div>



        <script type="text/javascript">
            function mostrarAlerta() {

                // La función mostrarAlerta se ejecutará solo si el proceso fue exitoso
                swal({
                    title: "Registrado!",
                    text: "¡Datos completados correctamente!",
                    icon: "success",
                    button: "OK"
                })
                        .then((value) => {
                            // Si el usuario hace clic en OK, recargar la página
                            if (value) {
                                location.reload();
                            }
                        });
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    </h:body>
</html>

